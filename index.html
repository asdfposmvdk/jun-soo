<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AILee Cam - í›„ë©´ì¹´ë©”ë¼ ì§€ë¬¸ ìº¡ì²˜ + AI ì„ ëª…ë„ ì ìˆ˜</title>

  <!--
    AILee Cam - Rear Camera Finger Capture + Quality Score Demo
    MIT License (c) 2025 ê¹½í˜¸

    âš  ì´ ë°ëª¨ì˜ "AI ì¸ì‹ ì ìˆ˜"ëŠ” ì‹¤ì œ ì§€ë¬¸ ì¸ì¦/ì‹ë³„ì´ ì•„ë‹ˆë¼,
      ìº¡ì²˜ëœ ì‚¬ì§„ì—ì„œ ì§€ë¬¸ ì„ (ë””í…Œì¼)ê³¼ ëŒ€ë¹„(ì»¨íŠ¸ë¼ìŠ¤íŠ¸)ê°€
      ì–¼ë§ˆë‚˜ ì˜ ë³´ì´ëŠ”ì§€ì— ëŒ€í•œ ëŒ€ëµì ì¸ í’ˆì§ˆ ì¶”ì •ì…ë‹ˆë‹¤.
  -->

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
      background:#f5f5f5;
      padding:10px;
    }
    .container {
      max-width:480px;
      margin:0 auto;
      background:#fff;
      border-radius:12px;
      box-shadow:0 2px 8px rgba(0,0,0,0.08);
      padding:20px;
    }
    .header {
      text-align:center;
      margin-bottom:16px;
      border-bottom:2px solid #0070d2;
      padding-bottom:10px;
    }
    .header h1 {
      font-size:20px;
      color:#0070d2;
      margin-bottom:4px;
    }
    .header p {
      font-size:12px;
      color:#666;
    }

    .message {
      padding:8px 10px;
      margin-bottom:8px;
      border-radius:6px;
      font-size:12px;
      display:none;
      word-break:break-word;
    }
    .message.show { display:block; }
    .message.info {
      background:#e7f3ff;
      border-left:4px solid #0070d2;
      color:#0070d2;
    }
    .message.warn {
      background:#fff8e1;
      border-left:4px solid #ffb300;
      color:#ff8f00;
    }
    .message.error {
      background:#fef1f0;
      border-left:4px solid #c23030;
      color:#c23030;
    }
    .message.success {
      background:#dffcf0;
      border-left:4px solid #04844b;
      color:#04844b;
    }

    .video-container {
      position:relative;
      width:100%;
      max-width:480px;
      margin:0 auto 10px;
      background:#000;
      border-radius:10px;
      overflow:hidden;
      display:none;
    }
    video {
      width:100%;
      height:auto;
      display:block;
      object-fit:cover;
      background:#000;
    }
    .video-label {
      position:absolute;
      top:8px;
      left:8px;
      padding:4px 8px;
      border-radius:4px;
      background:rgba(0,0,0,0.6);
      color:#eee;
      font-size:11px;
      pointer-events:none;
    }

    .finger-guide {
      position:absolute;
      top:50%;
      left:50%;
      width:40%;
      height:40%;
      transform:translate(-50%,-50%);
      border-radius:12px;
      border:3px dashed rgba(255,255,255,0.9);
      box-shadow:0 0 0 2px rgba(0,0,0,0.4);
      pointer-events:none;
    }
    .finger-text {
      position:absolute;
      bottom:8px;
      left:50%;
      transform:translateX(-50%);
      padding:4px 8px;
      border-radius:999px;
      background:rgba(0,0,0,0.7);
      color:#fff;
      font-size:11px;
    }

    .button-group {
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:8px;
      margin-bottom:8px;
    }
    button {
      padding:10px 12px;
      border:none;
      border-radius:6px;
      font-size:13px;
      font-weight:600;
      cursor:pointer;
      min-height:40px;
      transition:.15s;
    }
    button:active { transform:scale(.97); }
    .btn-brand { background:#0070d2; color:#fff; }
    .btn-brand:hover { background:#005bb5; }
    .btn-cancel { background:#e0e0e0; color:#333; }
    .btn-cancel:hover { background:#d0d0d0; }
    .btn-disabled { background:#ccc !important; cursor:not-allowed !important; }

    .hint {
      font-size:11px;
      color:#666;
      margin-bottom:8px;
      line-height:1.4;
    }

    .capture-preview {
      margin-top:12px;
      border-top:1px solid #eee;
      padding-top:10px;
    }
    .capture-preview h2 {
      font-size:13px;
      margin-bottom:6px;
      color:#333;
    }
    .preview-img {
      width:100%;
      max-height:360px;
      object-fit:contain;
      border-radius:8px;
      border:1px solid #ddd;
      background:#000;
    }
    .meta {
      font-size:11px;
      color:#555;
      margin-top:6px;
    }

    /* AI ì¸ì‹/ì„ ëª…ë„ ì ìˆ˜ í‘œì‹œ */
    .ai-quality {
      margin-top:10px;
      padding:8px 10px;
      border-radius:6px;
      background:#f5f7fb;
      font-size:12px;
    }
    .ai-quality h2 {
      font-size:13px;
      margin-bottom:6px;
      color:#333;
    }
    .ai-bar {
      width:100%;
      height:10px;
      border-radius:999px;
      background:#e0e3f0;
      overflow:hidden;
      margin-bottom:6px;
    }
    .ai-bar-fill {
      height:100%;
      width:0%;
      border-radius:999px;
      background:linear-gradient(90deg,#ff6b6b,#feca57,#1dd1a1);
      transition:width 0.3s ease;
    }
    .ai-score-text {
      font-size:12px;
      color:#444;
    }
    .ai-score-text b {
      font-size:13px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>AILee Cam</h1>
      <p>í›„ë©´ ì¹´ë©”ë¼ ì§€ë¬¸ ìº¡ì²˜ + AI ì„ ëª…ë„ ì ìˆ˜</p>
    </div>

    <div id="statusMessage" class="message info show">
      ğŸ”¹ ëª¨ë°”ì¼ì—ì„œ ì ‘ì† í›„ [ì‹œì‘]ì„ ëˆ„ë¥´ê³ , í›„ë©´ ì¹´ë©”ë¼ë¡œ ì†ê°€ë½ì„ ë„¤ëª¨ ì•ˆì— í¬ê²Œ ê°€ì ¸ì™€ ì£¼ì„¸ìš”.
    </div>

    <div id="videoContainer" class="video-container">
      <video id="video" autoplay playsinline muted></video>
      <div class="video-label">í›„ë©´ ì¹´ë©”ë¼ ë¯¸ë¦¬ë³´ê¸°</div>
      <div class="finger-guide"></div>
      <div class="finger-text">ì†ê°€ë½ ì§€ë¬¸ ë¶€ë¶„ì„ ì´ ì•ˆì— í¬ê²Œ ë„£ì–´ì£¼ì„¸ìš”</div>
    </div>

    <!-- ìº”ë²„ìŠ¤: ì‹¤ì œ ìº¡ì²˜(ì›ë³¸ í•´ìƒë„)ìš©, í™”ë©´ì—ëŠ” ì•ˆ ë³´ì„ -->
    <canvas id="captureCanvas" style="display:none;"></canvas>

    <div class="button-group">
      <button id="startBtn" class="btn-brand" onclick="startCamera()">ì‹œì‘</button>
      <button id="stopBtn"  class="btn-cancel btn-disabled" onclick="stopCamera()">ì¢…ë£Œ</button>
    </div>
    <div class="button-group">
      <button id="captureBtn" class="btn-brand btn-disabled" onclick="captureFrame()">ì§€ë¬¸ ìº¡ì²˜</button>
      <button id="downloadBtn" class="btn-brand btn-disabled" onclick="downloadImage()">ì´ë¯¸ì§€ ì €ì¥</button>
    </div>

    <div class="hint">
      ğŸ“Œ íŒ<br/>
      - ì†ê°€ë½ì„ ë Œì¦ˆì—ì„œ <b>5~10cm ì •ë„ ê±°ë¦¬</b>ì— ë‘ê³ , ì§€ë¬¸ì„ ì´ í™”ë©´ì—ì„œ ëˆˆìœ¼ë¡œ ë³´ì¼ ì •ë„ë¡œ ë§ì¶°ì£¼ì„¸ìš”.<br/>
      - ì˜†ì—ì„œ ì€ì€í•œ ë¹›ì´ ë“¤ì–´ì˜¤ë©´ ì§€ë¬¸ ê³¨ì´ ë” ì˜ ë³´ì…ë‹ˆë‹¤.<br/>
      - ì´¬ì˜ ì „ì— ë Œì¦ˆë¥¼ í•œ ë²ˆ ë‹¦ì•„ ì£¼ë©´ ë” ì„ ëª…í•´ì§‘ë‹ˆë‹¤.
    </div>

    <div class="capture-preview">
      <h2>ìº¡ì²˜ëœ ì§€ë¬¸ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°</h2>
      <img id="capturedImage" class="preview-img" alt="ìº¡ì²˜ëœ ì§€ë¬¸ ì´ë¯¸ì§€" />
      <div id="captureMeta" class="meta"></div>

      <!-- AI í’ˆì§ˆ/ì¸ì‹ ì ìˆ˜ ì˜ì—­ -->
      <div class="ai-quality">
        <h2>AI ì§€ë¬¸ ì¸ì‹/ì„ ëª…ë„ ì¶”ì •</h2>
        <div class="ai-bar">
          <div id="aiBarFill" class="ai-bar-fill"></div>
        </div>
        <div id="aiScoreText" class="ai-score-text">
          ì•„ì§ ìº¡ì²˜ëœ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ìœ„ì—ì„œ [ì§€ë¬¸ ìº¡ì²˜]ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.
        </div>
      </div>
    </div>
  </div>

  <script>
    let stream = null;
    let videoEl = null;
    let canvasEl = null;
    let lastCaptureDataUrl = null;

    const statusMessage = document.getElementById("statusMessage");
    const startBtn      = document.getElementById("startBtn");
    const stopBtn       = document.getElementById("stopBtn");
    const captureBtn    = document.getElementById("captureBtn");
    const downloadBtn   = document.getElementById("downloadBtn");
    const videoContainer= document.getElementById("videoContainer");
    const capturedImage = document.getElementById("capturedImage");
    const captureMeta   = document.getElementById("captureMeta");

    const aiBarFill     = document.getElementById("aiBarFill");
    const aiScoreText   = document.getElementById("aiScoreText");

    function setStatus(type, text){
      statusMessage.textContent = text;
      statusMessage.classList.add("show");
      statusMessage.classList.remove("info","warn","error","success");
      if(type === "info")       statusMessage.classList.add("info");
      else if(type === "warn")  statusMessage.classList.add("warn");
      else if(type === "error") statusMessage.classList.add("error");
      else if(type === "success") statusMessage.classList.add("success");
    }

    function setButtons(state){
      // state: "idle" | "camera" | "captured"
      if(state === "idle"){
        startBtn.disabled    = false;
        stopBtn.disabled     = true;
        stopBtn.classList.add("btn-disabled");
        captureBtn.disabled  = true;
        captureBtn.classList.add("btn-disabled");
        downloadBtn.disabled = true;
        downloadBtn.classList.add("btn-disabled");
      } else if(state === "camera"){
        startBtn.disabled    = true;
        stopBtn.disabled     = false;
        stopBtn.classList.remove("btn-disabled");
        captureBtn.disabled  = false;
        captureBtn.classList.remove("btn-disabled");
        downloadBtn.disabled = !lastCaptureDataUrl;
        downloadBtn.classList.toggle("btn-disabled", !lastCaptureDataUrl);
      } else if(state === "captured"){
        startBtn.disabled    = true;
        stopBtn.disabled     = false;
        stopBtn.classList.remove("btn-disabled");
        captureBtn.disabled  = false;
        captureBtn.classList.remove("btn-disabled");
        downloadBtn.disabled = !lastCaptureDataUrl;
        downloadBtn.classList.toggle("btn-disabled", !lastCaptureDataUrl);
      }
    }

    // í›„ë©´ ì¹´ë©”ë¼ + ê³ í•´ìƒë„ + ì´ˆì /ì¤Œ íŒíŠ¸
    async function startCamera(){
      setStatus("warn","ì¹´ë©”ë¼ ê¶Œí•œì„ ìš”ì²­ ì¤‘ì…ë‹ˆë‹¤...");

      const primaryConstraints = {
        video: {
          facingMode: { exact: "environment" },     // í›„ë©´ ì¹´ë©”ë¼ ê°•ì œ ì‹œë„
          width:  { min: 1280, ideal: 1920 },
          height: { min: 720,  ideal: 1080 },
          frameRate: { ideal: 30 }
        },
        audio: false
      };

      const fallbackConstraints = {
        video: {
          facingMode: "environment",
          width:  { min: 640, ideal: 1280 },
          height: { min: 480, ideal: 720 },
          frameRate: { ideal: 24 }
        },
        audio: false
      };

      try {
        try {
          // 1ì°¨: í›„ë©´ ì¹´ë©”ë¼ ê°•ì œ
          stream = await navigator.mediaDevices.getUserMedia(primaryConstraints);
        } catch (e1) {
          console.warn("í›„ë©´ ì¹´ë©”ë¼ exact ì‹¤íŒ¨, fallback ì‹œë„:", e1);
          // 2ì°¨: environment ì„ í˜¸
          stream = await navigator.mediaDevices.getUserMedia(fallbackConstraints);
        }

        videoEl = document.getElementById("video");
        videoEl.srcObject = stream;
        await videoEl.play();

        // ì§€ì› ê¸°ê¸°ì—ì„œ ì´ˆì /ì¤Œ ì„¤ì • íŒíŠ¸ ì£¼ê¸°
        try {
          const [track] = stream.getVideoTracks();
          if(track && track.getCapabilities && track.applyConstraints){
            const caps = track.getCapabilities();
            const advanced = [];

            if(caps.focusMode && caps.focusMode.includes("continuous")){
              advanced.push({ focusMode: "continuous" });
            }
            if(caps.focusMode && caps.focusMode.includes("macro")){
              // ì§€ë¬¸ì²˜ëŸ¼ ê°€ê¹Œìš´ í”¼ì‚¬ì²´ìš© ëª¨ë“œê°€ ìˆë‹¤ë©´ ì‚¬ìš©
              advanced.push({ focusMode: "macro" });
            }
            if(caps.zoom && typeof caps.zoom.max === "number"){
              const minZ = caps.zoom.min || 1;
              const maxZ = caps.zoom.max;
              const midZ = Math.min(maxZ, minZ + (maxZ - minZ) * 0.5); // ì¤‘ê°„ ì •ë„ ì¤Œ
              advanced.push({ zoom: midZ });
            }

            if(advanced.length > 0){
              await track.applyConstraints({ advanced });
              console.log("ê³ ê¸‰ ì¹´ë©”ë¼ ì„¤ì • ì ìš©:", advanced);
            }
          }
        } catch(e2){
          console.warn("ì´ˆì /ì¤Œ íŒíŠ¸ ì ìš© ì‹¤íŒ¨(ë¬´ì‹œ ê°€ëŠ¥):", e2);
        }

        canvasEl = document.getElementById("captureCanvas");
        videoContainer.style.display = "block";

        setStatus(
          "info",
          "í›„ë©´ ì¹´ë©”ë¼ í™œì„±í™” ì™„ë£Œ. ì†ê°€ë½ì„ ë Œì¦ˆì—ì„œ 5~10cm ê±°ë¦¬ì—ì„œ ë„¤ëª¨ ì•ˆì— í¬ê²Œ ë„£ê³ , ì§€ë¬¸ì„ ì´ í™”ë©´ì— ë³´ì¼ ë•Œ [ì§€ë¬¸ ìº¡ì²˜]ë¥¼ ëˆŒëŸ¬ë³´ì„¸ìš”."
        );
        setButtons("camera");

      } catch(e){
        console.error("ì¹´ë©”ë¼ ì‹œì‘ ì‹¤íŒ¨:", e);
        setStatus("error","ì¹´ë©”ë¼ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: " + e.message);
        setButtons("idle");
      }
    }

    function stopCamera(){
      if(stream){
        stream.getTracks().forEach(t => t.stop());
      }
      stream = null;
      videoContainer.style.display = "none";
      setStatus("info","ì¹´ë©”ë¼ë¥¼ ì¢…ë£Œí–ˆìŠµë‹ˆë‹¤.");
      setButtons("idle");
    }

    function captureFrame(){
      if(!videoEl || !canvasEl){
        setStatus("error","ì¹´ë©”ë¼ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
        return;
      }

      const vw = videoEl.videoWidth;
      const vh = videoEl.videoHeight;
      if(!vw || !vh){
        setStatus("error","ì˜ìƒ í”„ë ˆì„ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
        return;
      }

      // ìº”ë²„ìŠ¤ë¥¼ ì‹¤ì œ í”„ë ˆì„ í•´ìƒë„ë¡œ ë§ì¶°ì„œ ìµœëŒ€í•œ ë””í…Œì¼ ìœ ì§€
      canvasEl.width  = vw;
      canvasEl.height = vh;

      const ctx = canvasEl.getContext("2d");
      ctx.drawImage(videoEl, 0, 0, vw, vh);

      lastCaptureDataUrl = canvasEl.toDataURL("image/jpeg", 0.95);
      capturedImage.src = lastCaptureDataUrl;

      captureMeta.textContent = `í•´ìƒë„: ${vw} x ${vh} / JPEG í’ˆì§ˆ: 0.95`;
      setStatus("success","ìº¡ì²˜ ì™„ë£Œ! ì•„ë˜ ë¯¸ë¦¬ë³´ê¸°ì™€ AI ì ìˆ˜ë¥¼ í™•ì¸í•´ ë³´ì„¸ìš”.");

      // ğŸ” AI ì¸ì‹/ì„ ëª…ë„ ì ìˆ˜ ê³„ì‚°
      const score = analyzeFingerprintQuality();
      updateAiScore(score);

      setButtons("captured");
    }

    // ì§€ë¬¸ ì¸ì‹/ì„ ëª…ë„ í’ˆì§ˆ ì¶”ì •
    // - ì¤‘ì•™ ì˜ì—­(ì´ë¯¸ì§€ ì „ì²´ì˜ ì•½ 40% ì •ì‚¬ê°í˜•)ì„ ëŒ€ìƒìœ¼ë¡œ
    //   - ëŒ€ë¹„(ë°ê¸° í‘œì¤€í¸ì°¨)
    //   - ì—£ì§€(ì´ì›ƒ í”½ì…€ ë°ê¸° ì°¨ì´)
    //   ë‘ ê°’ì„ í•©ì³ 0~1 ì‚¬ì´ë¡œ ì •ê·œí™”
    function analyzeFingerprintQuality(){
      if(!canvasEl) return 0;

      const w = canvasEl.width;
      const h = canvasEl.height;
      if(!w || !h) return 0;

      const ctx = canvasEl.getContext("2d");
      const img = ctx.getImageData(0,0,w,h);
      const data = img.data;

      // ì¤‘ì•™ë¶€ 40% ì˜ì—­ë§Œ ë¶„ì„ (ê°€ì¥ ì§€ë¬¸ì´ ìˆì„ ë²•í•œ ê³³)
      const x0 = Math.floor(w * 0.3);
      const x1 = Math.floor(w * 0.7);
      const y0 = Math.floor(h * 0.3);
      const y1 = Math.floor(h * 0.7);

      let sum = 0;
      let sumSq = 0;
      let count = 0;

      let edgeSum = 0;
      let edgeCount = 0;

      for(let y = y0; y < y1-1; y++){
        for(let x = x0; x < x1-1; x++){
          const idx = (y * w + x) * 4;
          const r = data[idx];
          const g = data[idx+1];
          const b = data[idx+2];
          const gray = 0.299*r + 0.587*g + 0.114*b;

          sum += gray;
          sumSq += gray * gray;
          count++;

          // ê°„ë‹¨ ì—£ì§€: ì˜¤ë¥¸ìª½, ì•„ë˜ìª½ê³¼ì˜ ë°ê¸° ì°¨ì´
          const idxR = (y * w + (x+1)) * 4;
          const idxD = ((y+1) * w + x) * 4;
          const grayR = 0.299*data[idxR]   + 0.587*data[idxR+1]   + 0.114*data[idxR+2];
          const grayD = 0.299*data[idxD]   + 0.587*data[idxD+1]   + 0.114*data[idxD+2];

          const diffR = Math.abs(gray - grayR);
          const diffD = Math.abs(gray - grayD);

          edgeSum += diffR + diffD;
          edgeCount += 2;
        }
      }

      if(count === 0) return 0;

      const mean = sum / count;
      const variance = (sumSq / count) - (mean*mean);
      const stdev = Math.sqrt(Math.max(variance, 0));

      const edgeAvg = edgeCount > 0 ? edgeSum / edgeCount : 0;

      // ê²½í—˜ì ìœ¼ë¡œ ì •í•œ ì •ê·œí™” ê¸°ì¤€ (ëŒ€ëµì ì¸ ê°’)
      const contrastNorm = Math.min(stdev / 40, 1);   // 0~40 ì •ë„ë¥¼ ìœ ì˜ë¯¸í•œ ëŒ€ë¹„ë¡œ ê°€ì •
      const edgeNorm     = Math.min(edgeAvg / 25, 1); // 0~25 ì •ë„ë¥¼ ìœ ì˜ë¯¸í•œ ì—£ì§€ ì„¸ê¸°

      // ëŒ€ë¹„ 40%, ì—£ì§€ 60% ê°€ì¤‘ì¹˜
      const score = Math.max(0, Math.min(1, 0.4*contrastNorm + 0.6*edgeNorm));

      return score;
    }

    function updateAiScore(score){
      const pct = Math.round(score * 100);

      aiBarFill.style.width = pct + "%";

      let levelText = "";
      let levelDesc = "";

      if(pct < 40){
        levelText = "ë‚®ìŒ";
        levelDesc = "ì§€ë¬¸ ì„ ì´ ê±°ì˜ ë³´ì´ì§€ ì•Šê±°ë‚˜ íë¦¿í•©ë‹ˆë‹¤. ì¹´ë©”ë¼ì— ì¢€ ë” ê°€ê¹ê²Œ/ì¡°ëª… ì¡°ì • í›„ ë‹¤ì‹œ ìº¡ì²˜í•´ ì£¼ì„¸ìš”.";
      } else if(pct < 70){
        levelText = "ë³´í†µ";
        levelDesc = "ì§€ë¬¸ì´ ì–´ëŠ ì •ë„ ë³´ì´ì§€ë§Œ, ë” ì„ ëª…í•˜ê²Œ ì°ìœ¼ë©´ ì¸ì‹ ì •í™•ë„ê°€ ì˜¬ë¼ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
      } else {
        levelText = "ì¢‹ìŒ";
        levelDesc = "ì§€ë¬¸ ì„ ì´ ë¹„êµì  ì˜ ë³´ì…ë‹ˆë‹¤. ì´ ì •ë„ë©´ ì¸ì‹ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìˆ˜ì¤€ì…ë‹ˆë‹¤.";
      }

      aiScoreText.innerHTML =
        `ì¶”ì • ì¸ì‹/ì„ ëª…ë„: <b>${pct}% (${levelText})</b><br/>` +
        `<span style="font-size:11px;color:#666;">â€» ì‹¤ì œ ì§€ë¬¸ ì¸ì¦ì´ ì•„ë‹ˆë¼, ì´ë¯¸ì§€ ë””í…Œì¼ ê¸°ë°˜ì˜ ëŒ€ëµì ì¸ í’ˆì§ˆ ì¶”ì •ì…ë‹ˆë‹¤.</span><br/>` +
        `<span style="font-size:12px;">${levelDesc}</span>`;
    }

    function downloadImage(){
      if(!lastCaptureDataUrl){
        setStatus("error","ë¨¼ì € [ì§€ë¬¸ ìº¡ì²˜]ë¥¼ í•´ì£¼ì„¸ìš”.");
        return;
      }
      const a = document.createElement("a");
      a.href = lastCaptureDataUrl;
      const ts = new Date().toISOString().replace(/[:.]/g,"-");
      a.download = `ailee_fingerprint_${ts}.jpg`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    window.addEventListener("unload", () => {
      if(stream){
        stream.getTracks().forEach(t=>t.stop());
      }
    });
  </script>
</body>
</html>
